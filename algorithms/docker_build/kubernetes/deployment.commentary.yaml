# For educational and portfolio purposes — version with commentary

# ---------------------------------------------------------
# Kubernetes Deployment manifest defining how a containerized
# application is deployed and managed in a Kubernetes cluster.
# It specifies the container image, replica count, environment
# variables, and storage configuration.
# ---------------------------------------------------------


apiVersion: apps/v1
kind: Deployment
metadata:
  name: estimation-π_2vCPUs # Name of the Deployment resource
spec:
  replicas: 2 # Number of pod replicas to create in K8s cluster
  selector:
    matchLabels:
      app: estimation-π_2vCPUs # Selector to match Pods by label; used by the Deployment to manage ephemeral and dynamically created Pods
  template: 
    metadata:
      labels:
        app: estimation-π_2vCPUs # Label assigned to pods (must match selector)
    spec:
      containers:
      - name: estimation-π_2vCPUs # Name of the container inside the pod
        image: dockerhub_user/estimation-π_2vCPUs # Docker image used to create the container (repository/image_name) f.e. DockerHub
        env:
        - name: NUM_THREADS # Environment variable defining the degree of parallelism
          value: "2" # Number of worker threads used in the π estimation algorithm
        volumeMounts:
        - name: results # Reference to the volume defined below
          mountPath: /workspace/results # Path inside the container where the volume will be mounted
      volumes:
      - name: results # Volume definition (must match the name in volumeMounts)
        hostPath:
          path: /home/worker1/results_est_π # Directory on the host node used to store results/logs generated by the container
          type: DirectoryOrCreate # Create the directory if it does not exist

        # Note: the 'env:' parameter is unnecessary for FIO benchmark tests